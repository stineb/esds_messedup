<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Big Data for environmental sciences | Environmental Systems Data Science</title>
  <meta name="description" content="Text book and exercises. ETH, D-USYS, Fall semester 2020" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Big Data for environmental sciences | Environmental Systems Data Science" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Text book and exercises. ETH, D-USYS, Fall semester 2020" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Big Data for environmental sciences | Environmental Systems Data Science" />
  
  <meta name="twitter:description" content="Text book and exercises. ETH, D-USYS, Fall semester 2020" />
  

<meta name="author" content="Loïc Pellissier, Joshua Payne, Benjamin Stocker" />


<meta name="date" content="2020-06-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="primers.html"/>
<link rel="next" href="data-scraping-and-wrangling.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="primers.html"><a href="primers.html"><i class="fa fa-check"></i><b>1</b> Primers</a><ul>
<li class="chapter" data-level="1.1" data-path="primers.html"><a href="primers.html#exercises"><i class="fa fa-check"></i><b>1.1</b> Exercises</a><ul>
<li class="chapter" data-level="1.1.1" data-path="primers.html"><a href="primers.html#overview"><i class="fa fa-check"></i><b>1.1.1</b> Overview</a></li>
<li class="chapter" data-level="1.1.2" data-path="primers.html"><a href="primers.html#reading-data-into-r"><i class="fa fa-check"></i><b>1.1.2</b> Reading data into R</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="primers.html"><a href="primers.html#how-to-use-bookdown-and-markdown"><i class="fa fa-check"></i><b>1.2</b> How to use Bookdown and Markdown</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="big-data-for-environmental-sciences.html"><a href="big-data-for-environmental-sciences.html"><i class="fa fa-check"></i><b>2</b> Big Data for environmental sciences</a><ul>
<li class="chapter" data-level="2.1" data-path="big-data-for-environmental-sciences.html"><a href="big-data-for-environmental-sciences.html#exercises-1"><i class="fa fa-check"></i><b>2.1</b> Exercises</a><ul>
<li class="chapter" data-level="2.1.1" data-path="big-data-for-environmental-sciences.html"><a href="big-data-for-environmental-sciences.html#overview-1"><i class="fa fa-check"></i><b>2.1.1</b> Overview</a></li>
<li class="chapter" data-level="2.1.2" data-path="big-data-for-environmental-sciences.html"><a href="big-data-for-environmental-sciences.html#read-multiple-files"><i class="fa fa-check"></i><b>2.1.2</b> Read multiple files</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-scraping-and-wrangling.html"><a href="data-scraping-and-wrangling.html"><i class="fa fa-check"></i><b>3</b> Data scraping and wrangling</a><ul>
<li class="chapter" data-level="3.1" data-path="data-scraping-and-wrangling.html"><a href="data-scraping-and-wrangling.html#exercises-2"><i class="fa fa-check"></i><b>3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="model-data-fusion.html"><a href="model-data-fusion.html"><i class="fa fa-check"></i><b>4</b> Model-data fusion</a><ul>
<li class="chapter" data-level="4.1" data-path="model-data-fusion.html"><a href="model-data-fusion.html#exercises-3"><i class="fa fa-check"></i><b>4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="supervised-learning.html"><a href="supervised-learning.html"><i class="fa fa-check"></i><b>5</b> Supervised learning</a></li>
<li class="chapter" data-level="6" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html"><i class="fa fa-check"></i><b>6</b> Unsupervised learning</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Environmental Systems Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="big-data-for-environmental-sciences" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> Big Data for environmental sciences</h1>
<div id="exercises-1" class="section level2">
<h2><span class="header-section-number">2.1</span> Exercises</h2>
<p>We have time series data obtained from multiple sites. A common task is to complement our data with information about the sites (meta data), or with data from other sources and analyse it using this additional data. In this exercise, you will learn to…</p>
<div id="overview-1" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Overview</h3>
<ul>
<li><strong>Input</strong>: From the last session they learned how to look at two flux tower site of dataset 1.<br />
</li>
<li><strong>Output</strong>: They have gotten familiar with the dataset 2, which contains multiple site</li>
</ul>
<p><strong>Content</strong></p>
<ul>
<li>Meta data</li>
<li>Combining data: For our set of FLUXNET sites, collect data from other sources (global fields, remote sensing)</li>
<li>Finding, accessing, downloading, and reading environmental data from the web, web scraping</li>
<li>MODIS, Landsat, Google Earth Engine, Worldclim, Chelsa, CRU, (some re-analysis), CMIP5 from Urs, HWSD, ETOPO1, Biome classification, IGBP veg types, Koeppen-Geiger climate, ……</li>
<li>Merging, nesting</li>
<li>Formats: geo data: raster, NetCDF, CSV, shapefile</li>
<li>bash, cron, wget, grep, system, RegExp</li>
</ul>
</div>
<div id="read-multiple-files" class="section level3">
<h3><span class="header-section-number">2.1.2</span> Read multiple files</h3>
<p>Find all daily time series data in the <code>&quot;./data&quot;</code> directory. Files are identified here by their name, which contains the pattern <code>&quot;DD&quot;</code> (for ‘daily’).</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">filelist &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="st">&quot;./data&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;DD&quot;</span>)</a></code></pre></div>
<p>This returns 19 files for 19 sites. We can read them in at once using a simple loop. Here, we are creating a list of data frames of length 19.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">list_df &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="cf">for</span> (ifil <span class="cf">in</span> filelist){</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">  list_df[[ifil]] &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="kw">paste0</span>(<span class="st">&quot;./data/&quot;</span>, ifil))</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">}</a></code></pre></div>
<p>In <em>tidyverse</em>, this could be done on one line by:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">list_df &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(<span class="kw">as.list</span>(filelist), <span class="op">~</span><span class="kw">read_csv</span>(<span class="kw">paste0</span>(<span class="st">&quot;./data/&quot;</span>, .)))</a>
<a class="sourceLine" id="cb13-3" data-line-number="3"></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="co">## This returns a unnamed list. Let&#39;s add names as done above.</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="kw">names</span>(list_df) &lt;-<span class="st"> </span>filelist</a></code></pre></div>
<p>It may be unpractical to have the different dataframes as elements of a list. In fact, the data frames read in here each have similar shapes. I.e., they share the same columns (but differ by their number of rows, and of course, by their data values). This suggests that we can “stack” each dataframes along rows.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">df_allsites &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(list_df, <span class="dt">.id =</span> <span class="st">&quot;siteid&quot;</span>)</a></code></pre></div>
<p>This creates one single data frame containing all sites’ data (&gt;90’000 rows), and adds a column named <code>&quot;siteid&quot;</code> that is automatically created by using the names of the list elements of <code>list_df</code>.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="primers.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-scraping-and-wrangling.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["esds.pdf", "esds.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
